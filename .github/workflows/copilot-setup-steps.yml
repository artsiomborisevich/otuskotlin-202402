name: "Copilot Setup Steps"

# Automatically run the setup steps when they are changed to allow for easy validation, and
# allow manual testing through the repository's "Actions" tab
on:
  workflow_dispatch:
  push:
    paths:
      - .github/workflows/copilot-setup-steps.yml
  pull_request:
    paths:
      - .github/workflows/copilot-setup-steps.yml

permissions:
  id-token: write
  contents: write

jobs:
  # The job MUST be called `copilot-setup-steps` or it will not be picked up by Copilot.
  copilot-setup-steps:
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: â˜• Setup Java and Gradle
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'

      - name: ğŸ”’ Grant Execute Permission to gradlew
        run: chmod +x ./gradlew

      - name: ğŸ“‹ List Current Dependencies
        run: |
          echo "ğŸ“¦ Listing dependencies for all subprojects..."
          ./gradlew dependencies --configuration compileClasspath || true
          echo "âœ… Dependencies listed"

      - name: âš ï¸ Check for Deprecation Warnings
        run: |
          echo "Checking for deprecated method usages..."
          ./gradlew compileKotlin compileTestKotlin -Pkotlin.compiler.allWarningsAsErrors=false || true
          echo "Note: Review warnings above for deprecated APIs"

      - name: ğŸ§ª Run Tests to Establish Baseline
        run: |
          echo "ğŸ§ª Running check task (includes tests)..."
          ./gradlew check || echo "âš ï¸ Tests completed with issues (non-blocking for setup)"

      - name: ğŸ—ï¸ Build Project
        run: |
          echo "ğŸ—ï¸ Building project..."
          ./gradlew build || echo "âš ï¸ Build completed with issues (non-blocking for setup)"
